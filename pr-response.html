<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NA • anvil</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="NA"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">anvil</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/anvil.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/anvil.html">Get Started</a></li>
    <li><a class="dropdown-item" href="articles/random-numbers.html">Random Number Generation</a></li>
    <li><a class="dropdown-item" href="articles/type-promotion.html">Type Promotion</a></li>
    <li><a class="dropdown-item" href="articles/primitives.html">Primitives Overview</a></li>
    <li><a class="dropdown-item" href="articles/debugging.html">Debugging</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical"><li><a class="dropdown-item" href="articles/internals.html">Internals</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/anvil/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>NA</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-xla/anvil/blob/quickr/pr-response.md" class="external-link"><code>pr-response.md</code></a></small>
    </div>


<p>Thanks @sebffischer and @dfalbel for the thoughtful review. Replies inline:</p>
<ol style="list-style-type: decimal"><li>Package boundary</li>
</ol><ul><li>I agree it makes sense to keep the transformation in anvil for now because it depends on Graph internals and will likely evolve with them. As the quickr lowering stabilizes and grows, we can revisit splitting out just the transformation API later.</li>
</ul><ol start="2" style="list-style-type: decimal"><li>Custom quickr kernels inside PJRT/XLA</li>
</ol><ul><li>quickr currently only supports base R types, and there’s no efficient way (via the public API today) to consume a pointer to an f32 buffer; we’d have to materialize an f64 SEXP just to pass data into quickr.</li>
<li>Also, quickr has no GPU support yet. This is something I would like to add in the future, and it’s necessary before it can be a “custom kernel” approach.</li>
<li>I do think quickr could become a good language for writing custom kernels with GPU support and full XLA type coverage, but that will require changes on the quickr side to accommodate non-atomic SEXP types and external-buffer views.</li>
<li>I’m aligned with the caution here: the execution models, layouts, and type systems differ, so I don’t plan to bridge quickr kernels into XLA in this PR. If we ever explore that, it should be a separate design discussion.</li>
<li>I like the idea of letting users register custom primitives in anvil. For now the existing pattern (new primitive + rules) seems sufficient, but I’m open to a follow-up if there’s appetite.</li>
</ul><ol start="3" style="list-style-type: decimal"><li>Primitive-level tests vs XLA</li>
</ol><ul><li>Great suggestion. I can add a small, mostly automated test matrix that runs supported primitives through both backends (skipping if quickr is not installed). This should also help with the current coverage gap in the quickr files.</li>
</ul><ol start="4" style="list-style-type: decimal"><li>Literals / GraphLiteral support</li>
</ol><ul><li>Good catch. The quickr lowering does handle GraphLiteral inputs by inlining them as scalars, but this PR was cut before the recent GraphLiteral changes landed. I’ll rebase and add explicit tests (e.g., x + 1) to make sure literals work as expected.</li>
</ul><ol start="5" style="list-style-type: decimal"><li>jit() backend selection</li>
</ol><ul><li>I agree this would be a nice UX improvement. I’d prefer to keep it out of this PR and instead add a follow-up proposal for a multi-backend jit, possibly with an option to set the default.</li>
</ul><ol start="6" style="list-style-type: decimal"><li>Assumptions about input types/shapes at runtime</li>
</ol><ul><li>The compiled quickr function is specialized to the shapes and dtypes recorded in the Graph. We emit fixed-size allocations/loops (and use quickr::declare) based on those shapes, so runtime inputs are expected to match rank and shape. At the moment there is no dynamic-shape support or runtime validation; if inputs differ, behavior is undefined (likely an error or incorrect result). I can document this more explicitly.</li>
</ul><p>Other TODOs you listed - trace_fn with AbstractTensor inputs: agreed, but out of scope here. - compile_graph_pjrt helper in anvil: also agreed; happy to tackle separately.</p>
<p>Let me know if you prefer any of these follow-ups to be split into separate issues before I proceed.</p>


  </main></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Daniel Falbel, Nikolai German.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

