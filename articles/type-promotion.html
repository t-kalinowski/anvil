<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Type Promotion • anvil</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Type Promotion">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">anvil</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/anvil.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/anvil.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/type-promotion.html">Type Promotion</a></li>
    <li><a class="dropdown-item" href="../articles/primitives.html">Primitives Overview</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical">
<li><a class="dropdown-item" href="../articles/internals.html">Internals</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/anvil/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Type Promotion</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-xla/anvil/blob/quickr/vignettes/type-promotion.Rmd" class="external-link"><code>vignettes/type-promotion.Rmd</code></a></small>
      <div class="d-none name"><code>type-promotion.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="type-promotion-rules">Type Promotion Rules<a class="anchor" aria-label="anchor" href="#type-promotion-rules"></a>
</h2>
<p>When combining tensors of different types (e.g., adding an
<code>f32</code> to an <code>i32</code>), {anvil} needs to determine a
common type. For example, below we are adding an <code>f32</code> to an
<code>f64</code>, where the former is promoted to the latter’s type,
because it’s more expressive.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/anvil/" class="external-link">anvil</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jit.html">jit</a></span><span class="op">(</span><span class="va">nv_add</span><span class="op">)</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/nv_tensor.html">nv_scalar</a></span><span class="op">(</span><span class="fl">1.0</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/nv_tensor.html">nv_scalar</a></span><span class="op">(</span><span class="fl">1.0</span>, dtype <span class="op">=</span> <span class="st">"f64"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor </span></span>
<span><span class="co">##  2.0000</span></span>
<span><span class="co">## [ CPUf64{} ]</span></span></code></pre>
<p>The type-promotion rules are inspired by JAX, and they are designed
for execution on accelerators like GPUs, where one often wants speed
instead of precision.</p>
<p>The rules are defined by the <code><a href="../reference/common_dtype.html">common_dtype()</a></code> function. It
returns a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> with two values: the common dtype and a
flag indicating whether the result is ambiguous, which we will cover
later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/common_dtype.html">common_dtype</a></span><span class="op">(</span><span class="st">"f64"</span>, <span class="st">"f32"</span><span class="op">)</span><span class="op">$</span><span class="va">dtype</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">##  @ value: int 64</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/common_dtype.html">common_dtype</a></span><span class="op">(</span><span class="st">"i64"</span>, <span class="st">"f32"</span><span class="op">)</span><span class="op">$</span><span class="va">dtype</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">##  @ value: int 32</span></span></code></pre>
<p>A table with the promotion rules is below.</p>
<table class="table">
<caption>
Type promotion rules (row × column)
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
i1
</th>
<th style="text-align:left;">
i8
</th>
<th style="text-align:left;">
i16
</th>
<th style="text-align:left;">
i32
</th>
<th style="text-align:left;">
i64
</th>
<th style="text-align:left;">
ui8
</th>
<th style="text-align:left;">
ui16
</th>
<th style="text-align:left;">
ui32
</th>
<th style="text-align:left;">
ui64
</th>
<th style="text-align:left;">
f32
</th>
<th style="text-align:left;">
f64
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
i1
</td>
<td style="text-align:left;">
i1
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="literals-as-ambiguous-types">Literals as Ambiguous Types<a class="anchor" aria-label="anchor" href="#literals-as-ambiguous-types"></a>
</h2>
<p>Usually, the types in an {anvil} program can be deterministically
inferred from the input types. The only case where this is not possible
is when you use R literals. The default types for literals are as
follows:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/double.html" class="external-link">double()</a></code> -&gt; <code>dtype("f32")</code>
</li>
<li>
<code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code> -&gt; <code>dtype("i32")</code>
</li>
<li>
<code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical()</a></code> -&gt; <code>dtype("i1")</code> (bool)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jit.html">jit</a></span><span class="op">(</span>\<span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1.0</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## AnvilTensor </span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## [ CPUi32{} ] </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## AnvilTensor </span></span>
<span><span class="co">##  1.0000</span></span>
<span><span class="co">## [ CPUf32{} ] </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## AnvilTensor </span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## [ CPUpred{} ]</span></span></code></pre>
<p>However, because this is just a guess, they behave differently than
known types during promotion. Therefore, the <code>common_dtype</code>
function has two arguments indicating which of the data types are
ambiguous. Below, the first type is a known <code>f64</code> and the
second is an ambiguous <code>f32</code>. Within anvil, we denote the
latter as <code>i32?</code>. The result is an <code>f64</code>, although
we would promote to an <code>f64</code> if both were known. If both
types are ambiguous, the result is generally the same as if both were
known.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/common_dtype.html">common_dtype</a></span><span class="op">(</span><span class="st">"f32"</span>, <span class="st">"f64"</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dtype</span></span>
<span><span class="co">## &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">##  @ value: int 32</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ambiguous</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/common_dtype.html">common_dtype</a></span><span class="op">(</span><span class="st">"f32"</span>, <span class="st">"f64"</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dtype</span></span>
<span><span class="co">## &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">##  @ value: int 64</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ambiguous</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/common_dtype.html">common_dtype</a></span><span class="op">(</span><span class="st">"f32"</span>, <span class="st">"f64"</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $dtype</span></span>
<span><span class="co">## &lt;stablehlo::FloatType&gt;</span></span>
<span><span class="co">##  @ value: int 64</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ambiguous</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre>
<p>The promotion rules only change when one type is ambiguous and the
other is not. There, we usually promote the ambiguous type to the known
type, unless:</p>
<ol style="list-style-type: decimal">
<li>The ambiguous type is a float and the known type is not.</li>
<li>The known type is a bool but the ambiguous type is not.</li>
</ol>
<p>In both case, we promote the known type to the default type of the
ambiguous type. The table below shows the promotion rules, where the
rows are ambiguous and the columns are known.</p>
<table class="table">
<caption>
Promotion rules: ambiguous (row) × known (column)
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
i1
</th>
<th style="text-align:left;">
i8
</th>
<th style="text-align:left;">
i16
</th>
<th style="text-align:left;">
i32
</th>
<th style="text-align:left;">
i64
</th>
<th style="text-align:left;">
ui8
</th>
<th style="text-align:left;">
ui16
</th>
<th style="text-align:left;">
ui32
</th>
<th style="text-align:left;">
ui64
</th>
<th style="text-align:left;">
f32
</th>
<th style="text-align:left;">
f64
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
i1
</td>
<td style="text-align:left;">
i1
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
i8
</td>
<td style="text-align:left;">
i16
</td>
<td style="text-align:left;">
i32
</td>
<td style="text-align:left;">
i64
</td>
<td style="text-align:left;">
ui8
</td>
<td style="text-align:left;">
ui16
</td>
<td style="text-align:left;">
ui32
</td>
<td style="text-align:left;">
ui64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
<tr>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f64
</td>
<td style="text-align:left;">
f32
</td>
<td style="text-align:left;">
f64
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="propagating-ambiguity">Propagating Ambiguity<a class="anchor" aria-label="anchor" href="#propagating-ambiguity"></a>
</h2>
<p>Ambiguity is propagated through operations. Consider the following
example:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jit.html">jit</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1L</span></span>
<span>  <span class="va">z</span> <span class="op">*</span> <span class="va">y</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">f</span><span class="op">(</span><span class="fu"><a href="../reference/nv_tensor.html">nv_scalar</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="../reference/nv_tensor.html">nv_scalar</a></span><span class="op">(</span><span class="fl">2L</span>, dtype <span class="op">=</span> <span class="st">"i16"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## AnvilTensor </span></span>
<span><span class="co">##  4</span></span>
<span><span class="co">## [ CPUi16{} ]</span></span></code></pre>
<p>The type of <code>z</code> is <code>i32?</code>, because
<code>x</code> is promoted to an <code>i32</code>, the default type of
the <code>1L</code> literal. If <code>z</code> was not ambiguous, the
output would be an <code>i32</code>, because the <code>y</code> would be
promoted to an <code>i32</code> in the multiplication. Because we
propagate the ambiguity, the <code>z</code> is actually down-promoted to
an <code>i16</code>, because the <code>z</code> is ambiguous, while the
<code>y</code> is known.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Daniel Falbel, Nikolai German.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
